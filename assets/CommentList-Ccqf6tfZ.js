const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ReplyList-Cz06-PR3.js","assets/index-BoXezT9G.js","assets/index-BDdGAzmW.css"])))=>i.map(i=>d[i]);
import{j as e,P as m,r as a,k as Z,u as A,l as ee,m as se,n as te,f as I,o as le,p as ne,q as re,s as ae,B as ie,S as oe,_ as ce,i as w}from"./index-BoXezT9G.js";function V({value:y,isFull:C}){return e.jsxs(e.Fragment,{children:[y.length<15||C?y:y.slice(0,15)+"...",y.length>=15&&e.jsx("span",{className:"ml-1 text-xs text-blue-300 cursor-pointer hover:text-blue-400",children:!C&&"-see more-"})]})}V.propTypes={value:m.string,isFull:m.bool};const de=a.lazy(()=>ce(()=>import("./ReplyList-Cz06-PR3.js"),__vite__mapDeps([0,1,2])));function B(y){const{authorId:C,handleDeleteComment:E,handleRegThumbsDownClick:h,handleRegThumbsUpClick:F,handleSendReply:N,handleThumbsDownClick:v,handleThumbsupClick:$,isHome:i,optimComment:s,setOptimComments:U,setUserOfInterest:_}=y,L=s.replies.sort((x,P)=>new Date(P.timeStamp)-new Date(x.timeStamp)),[R,T]=a.useState(L),[j,t]=a.useState(!1),[r,o]=a.useState(!1),[l,n]=a.useState(!1),[f,p]=a.useState(s.likes.length),[b,g]=a.useState(s.dislikes.length),[c,u]=a.useState(""),[d,k]=a.useState(R.length),[S,G]=a.useState(!1),[J,O]=a.useState(!1),[K,Q]=a.useState(!1),[q,W]=a.useState(!1),X=Z(),z=a.useRef(null),{id:D}=A(),Y=s.comment;a.useEffect(()=>{const x=s.likes.includes(D),P=s.dislikes.includes(D);o(x),n(P)},[s,D]),a.useEffect(()=>{j&&z.current&&z.current.focus()},[j]);const H=s.commenterName||"Unknown user";return e.jsxs("section",{className:"bg-black rounded-xl",children:[e.jsxs("div",{className:"flex flex-col px-3 py-2 md:items-end md:flex-row md:justify-around",children:[e.jsxs("div",{className:"md:w-2/3",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("img",{onClick:()=>{D===s.commenterId?X(`/your-blogs/${D}`):_(s.commenterId)},src:s.buffer&&s.mimetype?`data:${s.mimetype};base64,${s.buffer}`:"/blog-frontend/assets/images/unknown-user.jpg",alt:"user",className:"w-5 h-5 rounded-full cursor-pointer"}),e.jsx("p",{className:"text-xs text-red-200",children:C===s.commenterId?H+" :The Author":H})]}),e.jsx("p",{onClick:()=>G(x=>!x),className:"mt-1 text-sm indent-1 ",children:e.jsx(V,{value:Y,isFull:S})}),e.jsx("p",{className:"mt-1 text-xs text-red-300",children:ee(s.timeStamp)})]}),e.jsxs("div",{className:"flex items-center justify-around w-1/2 md:w-2/3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[r?e.jsx(se,{size:12,className:"cursor-pointer hover:text-slate-400",onClick:()=>$(s,o,p)}):e.jsx(te,{size:12,className:"cursor-pointer hover:text-slate-400",onClick:()=>F(b,s,g,p,n,o,l)}),e.jsx("p",{className:"-ml-3",children:I(f)})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[l?e.jsx(le,{size:12,className:"cursor-pointer hover:text-slate-400",onClick:()=>v(s,g,n)}):e.jsx(ne,{size:12,className:"cursor-pointer hover:text-slate-400",onClick:()=>h(f,s,g,p,o,n,r)}),e.jsx("p",{className:"-ml-3",children:I(b)})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(re,{size:12,className:"cursor-pointer hover:text-slate-400",onClick:()=>t(!j)}),e.jsx("p",{onClick:()=>O(x=>!x),className:"pr-1 -ml-3 cursor-pointer hover:text-blue-400 hover:underline",children:!j&&d<0?k(0):I(d)})]}),!i&&e.jsx(ae,{size:12,className:`hover:animate-pulse ${K&&"animate-spin"}`,onClick:()=>E(s,Q)})]})]}),j&&e.jsxs("div",{className:"flex flex-col items-center mx-[10%]",children:[e.jsxs("form",{onSubmit:x=>N(x,s,c,W,T,k,u,O),className:"flex justify-around w-full",children:[e.jsx("input",{ref:z,type:"text",placeholder:"reply",value:c,onChange:x=>u(x.target.value),required:!0,className:"w-2/4 px-2 py-1 text-blue-800 rounded-lg outline-none focus:ring-2 hover:ring-1 ring-white"}),e.jsx("button",{type:"submit",disabled:q,className:"px-2 bg-blue-900 rounded-lg hover:bg-blue-800",children:q?e.jsxs("div",{className:"flex items-end",children:[e.jsx("span",{children:"reply"}),e.jsx(ie,{size:2,color:"white",className:"mb-1"})]}):"reply"})]}),e.jsx("p",{onClick:()=>O(x=>!x),className:"my-2 cursor-pointer hover:underline underline-offset-2",children:d<0?k(0):d!==1?I(d)+" Replies":I(d)+" Reply"})]}),e.jsx("div",{className:"flex flex-col space-y-4",children:J?R.length===0?e.jsx("p",{className:"text-sm text-center text-red-300",children:"No replies"}):e.jsx(a.Suspense,{fallback:e.jsx(oe,{}),children:e.jsx(de,{isHome:i,optimComment:s,optimReplies:R,setOptimComments:U,setOptimReplies:T,setReplyCount:k,setUserOfInterest:_})}):""})]})}B.propTypes={authorId:m.string.isRequired,handleDeleteComment:m.func,handleRegThumbsDownClick:m.func,handleRegThumbsUpClick:m.func,handleSendReply:m.func,handleThumbsDownClick:m.func,handleThumbsupClick:m.func,isHome:m.bool,optimComment:m.object,setOptimComments:m.func,setUserOfInterest:m.func};const me=a.memo(B);function M(y){const{blog:C,optimComments:E,onInteractionUpdate:h,isHome:F,setCommentCount:N,setOptimComments:v,setUserOfInterest:$}=y,{id:i}=A(),s=t=>`https://blog-backend-sandy-three.vercel.app/interaction/${t._id}`,U=a.useCallback(async(t,r,o,l,n,f,p)=>{f(!0),l(c=>c+1);const b=p,g=t;p&&(n(!1),o(c=>c-1));try{p&&await w.patch(s(r),{action:"removeCommentDislike",userId:i}),await w.patch(s(r),{action:"addCommentLike",userId:i});const c=r.dislikes.filter(d=>d!==i),u=[...r.likes,i];h(r._id,{likes:u,dislikes:c})}catch(c){console.error("Error removing dislike and or adding like:",c),f(!1),l(u=>u-1),n(b),o(g)}},[i,h]),_=a.useCallback(async(t,r,o)=>{r(!1),o(l=>l-1);try{await w.patch(s(t),{action:"removeCommentLike",userId:i});const l=t.likes.filter(n=>n!==i);h(t._id,{likes:l,dislikes:t.dislikes})}catch(l){console.error("Error removing like:",l),r(!0),o(n=>n+1)}},[i,h]),L=a.useCallback(async(t,r,o,l,n,f,p)=>{f(!0),o(c=>c+1);const b=p,g=t;p&&(n(!1),l(c=>c-1));try{p&&await w.patch(s(r),{action:"removeCommentLike",userId:i}),await w.patch(s(r),{action:"addCommentDislike",userId:i});const c=r.likes.filter(d=>d!==i),u=[...r.dislikes,i];h(r._id,{likes:c,dislikes:u})}catch(c){console.log("Error adding dislike and or removing like:",c),f(!1),o(u=>u-1),n(b),l(g)}},[i,h]),R=a.useCallback(async(t,r,o)=>{o(!1),r(l=>l-1);try{await w.patch(s(t),{action:"removeCommentDislike",userId:i});const l=t.dislikes.filter(n=>n!==i);h(t._id,{likes:t.likes,dislikes:l})}catch(l){console.error("Error removing dislike:",l),o(!0),r(n=>n+1)}},[i,h]),T=a.useCallback(async(t,r)=>{r(!0),v(l=>l.filter(n=>n._id!==t._id)),N(l=>l-1);const o=`https://blog-backend-sandy-three.vercel.app/delete-comment/${encodeURIComponent(t._id)}`;try{await w.delete(o)}catch(l){console.error("Error deleting comment",l),t&&(v(n=>[...n,t].sort((f,p)=>new Date(p.timeStamp)-new Date(f.timeStamp))),N(n=>n+1))}finally{r(!1)}},[N,v]),j=a.useCallback(async(t,r,o,l,n,f,p,b)=>{t.preventDefault(),l(!0);const g=new Date().getTime().toString(),c={_id:g,replierId:i,reply:o,timeStamp:new Date().toISOString()};n(u=>[...u,c].sort((d,k)=>new Date(k.timeStamp)-new Date(d.timeStamp))),f(u=>u+1),p("");try{const d=(await w.patch(s(r),{action:"reply",userId:i,reply:o})).data.newReply;if(!d)throw new Error("Error receiving the new reply");n(k=>k.map(S=>S._id===g?d:S)),h(r._id,{replies:[...r.replies,d].sort((k,S)=>new Date(S.timeStamp)-new Date(k.timeStamp))}),b(!0)}catch(u){console.error("Error comming",u),n(d=>d.filter(k=>k._id!==g)),f(d=>d-1)}finally{l(!1)}},[i,h]);return e.jsx(e.Fragment,{children:E.map(t=>e.jsx(me,{authorId:C.authorId,handleDeleteComment:T,handleRegThumbsDownClick:L,handleRegThumbsUpClick:U,handleSendReply:j,handleThumbsDownClick:R,handleThumbsupClick:_,isHome:F,onInteractionUpdate:h,optimComment:t,setOptimComments:v,setUserOfInterest:$},`${t._id}-${t.likes.length}-${t.dislikes.length}`))})}M.propTypes={blog:m.object.isRequired,optimComments:m.array.isRequired,onInteractionUpdate:m.func,isHome:m.bool,setCommentCount:m.func,setOptimComments:m.func,setUserOfInterest:m.func};const ue=a.memo(M),he=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"}));export{he as C,V as S};
