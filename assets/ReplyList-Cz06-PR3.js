import{r as c,k as b,u as I,j as r,l as C,s as g,P as l,i as N}from"./index-BoXezT9G.js";import{S as v}from"./CommentList-Ccqf6tfZ.js";function j(u){const{handleDeleteReply:d,isHome:i,optimReply:e,setUserOfInterest:p}=u,[n,o]=c.useState(!1),[f,x]=c.useState(!1),s=b(),{id:m}=I(),y=e.reply,a=e.replierName||"Unkonwn user";return r.jsxs("section",{className:"flex flex-col items-center px-10",children:[r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx("p",{className:"text-xs text-red-200",children:e.authorId===e.replierId?" Author: "+a:a}),r.jsx("img",{onClick:()=>{m===e.replierId?s(`/your-blogs/${m}`):p(e.replierId)},src:e.buffer&&e.mimetype?`data:${e.mimetype};base64,${e.buffer}`:"/blog-frontend/assets/images/unknown-user.jpg",alt:"user",className:"w-5 h-5 rounded-full cursor-pointer"})]}),r.jsx("p",{onClick:()=>o(t=>!t),className:"mb-1 text-sm text-center",children:r.jsx(v,{value:y,isFull:n})}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("p",{className:"text-[10px] text-red-300 -mt-1.5",children:C(e.timeStamp)}),!i&&r.jsx(g,{size:12,className:`hover:animate-pulse mb-1.5 ml-1 ${f&&"animate-spin"}`,onClick:()=>d(e,x)})]})]})}j.propTypes={handleDeleteReply:l.func,isHome:l.bool,optimReply:l.object,setUserOfInterest:l.func};const k=c.memo(j);function O(u){const{isHome:d,optimComment:i,optimReplies:e,setOptimComments:p,setOptimReplies:n,setReplyCount:o,setUserOfInterest:f}=u,x=c.useCallback(async(s,m)=>{m(!0),console.log(s),n(a=>a.filter(t=>t._id!==s._id)),o(a=>a-1);const y=`https://blog-backend-sandy-three.vercel.app/interaction/${encodeURIComponent(s._id)}`;try{await N.patch(y,{action:"removeReply",userId:s.replierId}),p(a=>a.map(t=>t._id===i._id?{...t,replies:t.replies.filter(h=>h._id!==s._id)}:t))}catch(a){console.error("Error deleting comment",a),s&&(n(t=>[...t,s].sort((h,R)=>new Date(R.timeStamp)-new Date(h.timeStamp))),o(t=>t+1))}finally{m(!1)}},[p,n,o,i]);return r.jsx(r.Fragment,{children:e.map(s=>r.jsx(k,{handleDeleteReply:x,isHome:d,optimReply:{...s,authorId:i.authorId},setUserOfInterest:f},s._id))})}O.propTypes={isHome:l.bool,optimComment:l.object,optimReplies:l.array,setOptimComments:l.func,setOptimReplies:l.func,setReplyCount:l.func,setUserOfInterest:l.func};export{O as default};
