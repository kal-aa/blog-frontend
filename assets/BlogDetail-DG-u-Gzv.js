const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CommentList-Ccqf6tfZ.js","assets/index-BoXezT9G.js","assets/index-BDdGAzmW.css"])))=>i.map(i=>d[i]);
import{r as s,j as t,a as te,b as se,c as ne,d as oe,e as ae,f as T,g as K,h as re,S as le,B as ie,_ as ce,P as e,u as me,i as y}from"./index-BoXezT9G.js";const de=s.lazy(()=>ce(()=>import("./CommentList-Ccqf6tfZ.js").then(N=>N.C),__vite__mapDeps([0,1,2])));function M(N){const{blog:u,commentCount:b,commentRef:F,commentValue:L,dislikeCount:O,editBodyPen:D,editBodyValue:H,expand:z,handleRegThumbsUpClick:$,handleRegThumbsDownClick:m,handleSendComment:d,handleThumbsDownClick:q,handleThumbsupClick:k,isHome:h,isSendingComment:I,likeCount:A,onInteractionUpdate:U,optimComments:p,pTagRef:V,readyToUpdate:w,setCommentCount:v,setCommentValue:_,setEditBodyPen:j,setEditBodyValue:C,setOptimComments:R,setShowComments:f,setUserOfInterest:Y,showComments:B,thumbsDown:G,thumbsUp:P,updateBtnRef:S}=N,[x,r]=s.useState(!1),a=s.useRef(null);return s.useEffect(()=>{x&&a.current&&a.current.focus()},[x]),t.jsxs("div",{className:h?z?"":"hidden":"",children:[t.jsxs("div",{className:"px-3 my-2 ",children:[D?t.jsx("textarea",{rows:4,value:H,onChange:c=>C(c.target.value),placeholder:"Your updated description should be 100 characters or more",className:"w-full px-2 py-1 rounded-md outline-none ring-2 hover:rounded-lg focus:bg-gray-100"}):t.jsx("p",{className:"inline leading-4 break-words indent-1",children:u.body}),!h&&(D?w?t.jsx(te,{onClick:()=>{S.current&&S.current.click()},size:18,className:"mb-1 text-red-600/60 hover:text-red-600/50"}):t.jsx(se,{onClick:()=>j(!1),size:18,className:"text-red-600/60 hover:text-red-600/50"}):t.jsx(ne,{title:"Edit the body",size:18,onClick:()=>j(c=>!c),className:`text-red-600 hover:text-red-600/80 inline ml-1 ${D&&"-mt-6"}`}))]}),t.jsxs("div",{className:"flex items-center justify-around",children:[t.jsxs("div",{className:"flex items-center",children:[P?t.jsx(oe,{className:"cursor-pointer hover:text-blue-900",onClick:k}):t.jsx(ae,{className:"cursor-pointer hover:text-blue-900",onClick:$}),t.jsx("p",{className:"ml-2",children:T(A)})]}),h&&t.jsxs("div",{className:"flex items-center",children:[G?t.jsx(K,{className:"cursor-pointer hover:text-blue-900",onClick:q}):t.jsx(K,{className:"hover:stroke-blue-900 stroke-[45px] stroke-black fill-transparent cursor-pointer",onClick:m}),t.jsx("p",{className:"ml-2",children:T(O)})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(re,{className:"cursor-pointer hover:text-blue-900",onClick:()=>r(c=>!c)}),B&&t.jsx("div",{ref:F,className:`text-white absolute z-0 bottom-[20%] -left-[10%] right-[20%] overflow-y-auto space-y-3 ${p.length<=1?"h-auto":"h-52"}`,children:p.length===0?t.jsx("p",{className:"flex items-center justify-center h-10 bg-black rounded-full",children:"No comments"}):t.jsx(s.Suspense,{fallback:t.jsx(le,{}),children:t.jsx(de,{blog:u,isHome:h,onInteractionUpdate:U,optimComments:p,setCommentCount:v,setOptimComments:R,setUserOfInterest:Y})})}),!x&&t.jsx("p",{onClick:()=>f(c=>!c),className:"ml-2 cursor-pointer hover:underline",ref:V,children:b!==1?T(b)+" Comments":T(b)+" Comment"})]})]}),x&&t.jsxs("div",{className:"flex flex-col items-center pt-5 md:pt-10 my-2 mx-[10%] bg-gray-400 rounded-xl",children:[t.jsxs("form",{onSubmit:d,className:"flex justify-around w-full",children:[t.jsx("input",{ref:a,type:"text",placeholder:"comment",value:L,onChange:c=>_(c.target.value),required:!0,className:"w-3/6 px-2 py-1 rounded-lg outline-none focus:ring-2 hover:ring-1 ring-white"}),t.jsx("button",{type:"submit",disabled:I,className:"px-4 text-white bg-black rounded-lg hover:bg-gray-900",children:I?t.jsxs("div",{className:"flex items-end",children:[t.jsx("span",{children:"post"}),t.jsx(ie,{size:2,color:"white",className:"mb-1"})]}):"post"})]}),t.jsx("p",{onClick:()=>f(c=>!c),className:"my-2 cursor-pointer hover:underline underline-offset-2",ref:V,children:b!==1?T(b)+" Comments":T(b)+" Comment"})]})]})}M.propTypes={blog:e.object,commentCount:e.number,commentRef:e.object,commentValue:e.string,dislikeCount:e.number,editBodyPen:e.bool,editBodyValue:e.string,expand:e.bool,handleRegThumbsDownClick:e.func,handleRegThumbsUpClick:e.func,handleSendComment:e.func,handleThumbsDownClick:e.func,handleThumbsupClick:e.func,isHome:e.bool,isSendingComment:e.bool,likeCount:e.number,onInteractionUpdate:e.func,optimComments:e.array,pTagRef:e.object,readyToUpdate:e.bool,setCommentCount:e.func,setCommentValue:e.func,setEditBodyPen:e.func,setEditBodyValue:e.func,setOptimComments:e.func,setShowComments:e.func,setUserOfInterest:e.func,showComments:e.bool,thumbsDown:e.bool,thumbsUp:e.bool,updateBtnRef:e.object};const ue=s.memo(M);function he(N){const{blog:u,comments:b,editBodyPen:F,editBodyValue:L,expand:O,isHome:D,readyToUpdate:H,setEditBodyPen:z,setEditBodyValue:$,setThumbsDown:m,setThumbsUp:d,setUserOfInterest:q,thumbsDown:k,thumbsUp:h,updateBtnRef:I}=N,A=b.sort((n,o)=>new Date(o.timeStamp)-new Date(n.timeStamp)),[U,p]=s.useState(A),[V,w]=s.useState(!1),[v,_]=s.useState(""),[j,C]=s.useState(u.likes.length),[R,f]=s.useState(u.dislikes.length),[Y,B]=s.useState(U.length),[G,P]=s.useState(!1),S=s.useRef(null),x=s.useRef(null),{id:r}=me();s.useEffect(()=>{const n=o=>{S.current&&!S.current.contains(o.target)&&x.current&&!x.current.contains(o.target)&&w(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[w]);const a=`https://blog-backend-sandy-three.vercel.app/interaction/${encodeURIComponent(u._id)}`,c=s.useCallback(async()=>{d(!0),C(l=>l+1);const n=k,o=R;k&&(m(!1),f(l=>l-1));try{k&&await y.patch(a,{action:"removeDislike",userId:r}),await y.patch(a,{action:"addLike",userId:r})}catch(l){console.error("Error updating like/dislike:",l),d(!1),C(i=>i-1),m(n),f(o)}},[m,k,d,R,a,r]),Q=s.useCallback(async()=>{d(!1),C(n=>n-1);try{await y.patch(a,{action:"removeLike",userId:r})}catch(n){console.error("Error removing like:",n),d(!0),C(o=>o+1)}},[d,a,r]),W=s.useCallback(async()=>{m(!0),f(l=>l+1);const n=h,o=j;h&&(d(!1),C(l=>l-1));try{h&&await y.patch(a,{action:"removeLike",userId:r}),await y.patch(a,{action:"addDislike",userId:r})}catch(l){console.error("Error removing like and or adding dislike:",l),m(!1),f(i=>i-1),d(n),C(o)}},[m,d,h,a,j,r]),X=s.useCallback(async()=>{m(!1),f(n=>n-1);try{await y.patch(a,{action:"removeDislike",userId:r})}catch(n){console.error("Error removing dislike:",n),m(!0),f(o=>o+1)}},[m,r,a]),Z=s.useCallback(async n=>{n.preventDefault(),P(!0);const o=new Date().getTime().toString(),l={_id:o,blogId:u._id,commenterId:r,comment:v,timeStamp:new Date().toISOString(),likes:[],dislikes:[],replies:[]};p(i=>[...i,l].sort((g,E)=>new Date(E.timeStamp)-new Date(g.timeStamp))),B(i=>i+1),_("");try{const g=(await y.patch(a,{action:"comment",userId:r,blogId:u._id,comment:v})).data.newComment;if(!g)throw new Error("Error receiving the new comment");p(E=>E.map(J=>J._id===o?g:J)),w(!0)}catch(i){console.error("Error comming",i),p(g=>g.filter(E=>E._id!==o)),B(g=>g-1)}finally{P(!1)}},[u._id,r,v,a]),ee=s.useCallback((n,o)=>{p(l=>l.map(i=>i._id===n?{...i,...o}:i))},[]);return t.jsx(ue,{blog:u,commentCount:Y,commentRef:S,commentValue:v,dislikeCount:R,editBodyPen:F,editBodyValue:L,expand:O,handleRegThumbsUpClick:c,handleRegThumbsDownClick:W,handleSendComment:Z,handleThumbsDownClick:X,handleThumbsupClick:Q,isHome:D,isSendingComment:G,likeCount:j,onInteractionUpdate:ee,optimComments:U,pTagRef:x,readyToUpdate:H,setCommentCount:B,setCommentValue:_,setEditBodyPen:z,setEditBodyValue:$,setOptimComments:p,setShowComments:w,setUserOfInterest:q,showComments:V,thumbsDown:k,thumbsUp:h,updateBtnRef:I})}he.propTypes={blog:e.object.isRequired,comments:e.array,editBodyPen:e.bool,editBodyValue:e.string,expand:e.bool,isHome:e.bool,readyToUpdate:e.bool,setEditBodyPen:e.func,setEditBodyValue:e.func,setThumbsDown:e.func,setThumbsUp:e.func,setUserOfInterest:e.func,thumbsDown:e.bool,thumbsUp:e.bool,updateBtnRef:e.object};export{he as default};
